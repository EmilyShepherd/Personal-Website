<?xml version="1.0" encoding="UTF-8"?>
<memo url="dnssec">
  <title>The keys to the Internet</title>
  <date day="11" month="October" year="2016" />

  <img 
    rel="header">https://emilyshepherd.me/images/dnssec_logo.png</img>
  <img rel="social">https://emilyshepherd.me/images/dnssec.png</img>
  <content>
    <section>
      <p>
        ICANN, which has been in the news recently as its contract with 
        the NTIA expired at the beginning of this month, is now up to 
        something far more mystifying: regenerating the Root Key Signing 
        Key.
      </p>

      <p>
        Let's take a quick step back from something so we can really 
        understand what that is. As I explained in my last article <ref 
          to="EM-ICANN" />, the Domain Name System (DNS) is the 
        Internet's phone book, it's what links nice names like 
        "google.com" to the underlying computer readable IP Address <ref 
          to="RFC1034" /><ref to="RFC1035" />.  This system is massively 
        distributed, with lots of servers and entries being added and 
        removed every day by various different entities.  Let's look at 
        the "google.com" to see what players are involved:
      </p>

      <p>
        At the top we've got the DNS Root, managed by ICANN/IANA, from 
        here authority for ".com" is delegated to Verisign, which is 
        known as a DNS "Registry".  Verisign runs its own servers for 
        all the ".com" records and it allows "Registrars" to make 
        changes to this.  Google has paid one such Registrar, 
        MarkMonitor, to delegate authority over "google.com" to Google's 
        servers <ref to="WHOIS-GOOGLE" />.  Google themselves are then 
        free to manage their own DNS records, adding things like 
        "mail.google.com" and "calendar.google.com".
      </p>

      <p>
        This is a brilliant system and very resilient to the massive 
        amount of usage it gets, but it does have one problem: with all 
        these people running their own servers and records, how do you 
        know that the information you get is correct? If you query a 
        server for "google.com" and you get a response pointing you say 
        216.58.201.14, how do you know that really is Google and not a 
        malicious party <em>pretending</em> to be Google in order to 
        steal your password?  This is where digital signatures come in.
      </p>
    </section>

    <section title="What on Earth are Digital Signatures?">
      <p>
        There are two kinds of encryption: symmetric and asymmetric.  
        When using symmetric encryption, anything you encrypt with a 
        password can be decrypted by that same password.  Asymmetric 
        encryption, however, uses two passwords: one public and one 
        private. The interesting thing here is that anything encrypted 
        by the public key can only be decrypted by the private key, and 
        similarly anything encrypted by the private key can only be 
        decrypted by the public key. Let's use an example to show how 
        this can be used to create a Digital Signature:
      </p>
      
      <p>
        I want to send Bob the signed message "Hi, I'm Emily.". I take 
        this message and encrypt it with my private key; let's say this 
        gives me the result "Blah, moo neigh" (in real encryption this 
        would just be a long stream of letters, numbers and symbols but 
        this is easier to understand and, more importantly, more fun).  
        I'm now going to send Bob the following three things:
      </p>

      <ul>
        <li>The Actual Message: "Hi, I'm Emily"</li>
        <li>The Message's Signature: "Blah, moo neigh"</li>
        <li>My Public Key</li>
      </ul>

      <p>
        When Bob receives this, he <em>decrypts</em> the signature 
        "Blah, moo neigh" with my Public Key. This gives him "Hi, I'm 
        Emily"; as this matches my message he knows for a fact that 
        signature was generated from my private key.  And as I'm the 
        only person who has access to my Private Key, the message 
        therefore must have come from me!
      </p>
    </section>

    <section title="Who signs the Domain Name System?">
      <p>
        Looking back on our original example, we saw that Google runs 
        its own servers and manages its own records for "google.com", so 
        it makes sense for Google to generate a public/private key pair, 
        publish their Public Key and then use their Private Key to sign 
        all their DNS records. That way everyone can confirm they are 
        correct. Brilliant, job done.
      </p>

      <p>
        Not quite. This just shifts the problem. We added a signature 
        because we wanted to know if we could trust the DNS records for 
        "google.com". Now, with a digital signature, we can tell that 
        they've come from whoever controls the Private Key which matches 
        the published Public Key, but how do we know that that published 
        Public Key is actually owned by Google?  What's to stop our 
        malicious party from generating their own public/private key 
        pair and using it to pretend to be Google?
      </p>

      <p>
        Well, Verisign, the manager of ".com" domains could generate a 
        public/private key pair, publish <em>its</em> Public Key then 
        use <em>its</em> Private Key to sign Google's Public Key. That 
        way we know that Verisign confirms Google's Public Key really 
        does belong to Google.
      </p>

      <p>
        Fantastic! But how now do we trust Verisign's key?
      </p>
      
      <p>
        Hopefully you can see where this is going: ICANN signs 
        Verisign's public key and publishes its own Public Key. This 
        process of signing each other creates what's known as a "chain 
        of trust" <ref to="RFC5011" /><ref to="RFC6781" />, but this 
        can't go on for ever.  At some point we just have to say "this 
        is a Public Key which isn't signed by anyone else but I trust it 
        anyway".
      </p>
      
      <p>
        That point is known as the "trust anchor" and, in the case of 
        the Domain Name System, that's ICANN's Root Zone Key Signing Key 
        (Root KSK for short) <ref to="RFC3757" />. Trust Anchors earn 
        their trust in other ways, such as being published in a variety 
        of trustworthy places, including IANA's site <ref to="IANA-KSK" 
          /> and the Internet Engineering Task Force <ref to="RFC7958" 
          /> (I'll even pop it in the footer of this article, because I 
        like to think of myself as a trustworthy gal!).  It also comes 
        hard coded into Operating Systems and the Software used by 
        Domain Name Servers; it's literally part of the code that comes 
        packaged in our software.
      </p>
    </section>

    <section title="Who Controls the Root Key Signing Key?">
      <p>
        As I'm sure you can imagine, this key is incredibly important; 
        if the Private Key were to fall into the wrong person's hands, 
        they can add their own authoritative records to the Root Zone.  
        Not Good. As such, it is kept under quite incredible conditions
        <ref to="ICANN-DPS" />.
      </p>

      <p>
        ICANN manages two secure facilities, one on the East Coast of 
        America and one on the West Coast; copies of the Root KSK are 
        kept at these; these are armoured buildings with armed guards.  
        Gaining access to the building requires multiple forms of ID.  
        It's secure.  But wait, there's more...
      </p>

      <p>
        Each of these facilities has an identical "Ceremony Room"; to 
        get in here, there's a finger print reader and even an iris 
        scanner. There is only one person, the Ceremony Officer, with 
        the authority to open this room and allow people to enter. To 
        one side of the room, there's a cage containing two safes; these 
        are rather creatively named "Safe 1" and "Safe 2". There are two 
        people who know the combination to each safe, the Safe Security 
        Controllers.
      </p>

      <p>
        Safe 1 is the simplest to explain so we'll start there; it 
        contains a laptop and two or more devices known as Hardware 
        Security Modules (HSMs). Each of these items is wrapped in a 
        tamper evident bag so it would be immediately obvious if they'd 
        been used since they were last put away.
      </p>

      <p>
        The Root KSK itself is stored within the HSMs; these are special 
        devices designed to store and use a Private Key without any risk 
        of it falling into the wrong hands. They have tamper detection 
        systems on them which will result in the key automatically being 
        destroyed if anyone tries to open the device. The <em>only</em> 
        way to have an HSM allow you to use the Private Key is by 
        presenting it with any three out of seven security cards, 
        controlled by seven "Crypto Officers". The Crypto Officers are 
        not ICANN employees, they are members of the technical community 
        chosen from all around the world.
      </p>

      <p>
        Here's where Safe 2 comes in; it contains seven safe deposit 
        boxes where the Crypto Officers' security cards are stored, 
        again within tamper evident bags. The safe deposit boxes require 
        2 keys to open, one "common key" held by the Ceremony Officer 
        and one held by the Crypto Officer.
      </p>

      <p>
        So, to sum up, in order to do anything with the KSK, you need 
        the Ceremony to open the Ceremony Room, the two Safe Security 
        Officers to open the safes and at least three Crypto Officers 
        with their safe deposit keys. ICANN has also added the extra 
        requirement that the Ceremony Officer is not allowed to do 
        anything (including even entering the Ceremony Room!) without 
        another person, the Internal Witness, being present. Every 
        single action which occurs within the Ceremony Room is logged; 
        when people enter the room, when a safe is opened, when 
        something is taken out of the safe, when a safe deposit box is 
        opened, etc...
      </p>

      <p>
        Because of all this security, the Root KSK is actually only used 
        four times per year; there are two Key Signing Ceremonies per 
        facility per year. These are streamed live on the Internet so 
        that absolutely anyone is able to act as an auditor for the 
        process.  At these ceremonies, another keypair, known as the 
        Zone Signing Key (ZSK) is signed by the Root KSK. This Zone 
        Signing Key is used for four months for ICANN's day to day 
        operations.  After the four months is up, the ZSK is discarded, 
        a new one is generated and a new ceremony is held to sign the 
        new copy.
      </p>

      <p>
        The Crypto Officers, with their safe deposit keys, can be 
        thought of being in possession of, quite literally, the physical 
        keys to the Internet.
      </p>
    </section>

    <section title="Key Generation, Backups &amp; Recovery">
      <p>
        The Root KSK was generated back in June 2010 in ICANN's East 
        Coast facility <ref to="ICANN-CERM1" /> <ref to="KSKCERM1" />, 
        using the laptop and HSMs in Safe 1 of that facility. At that 
        ceremony, a symmetric key was also generated (recall that this 
        is where the same key is used for encryption and decryption).  
        This key, known as the Storage Master Key (SMK), was then used 
        to encrypt the Private KSK to be exported and saved onto two USB 
        sticks <ref to="ICANN-CERM" />.
      </p>

      <p>
        The SMK was then split between seven security cards, such that 
        any five would be needed to form the whole SMK. These cards are 
        entrusted to another set of people, the Recovery Key 
        Shareholders, each of whom keep them in yet another tamper 
        evident bag.
      </p>

      <p>
        The USB sticks with the encrypted Private Key was then placed in 
        their own tamper evident bags; one was kept in Safe 1 as a 
        backup and the other was sent via courier to the West Coast 
        facility.
      </p>

      <p>
        The following month, five of the Recovery Key Shareholders met 
        in the West Coast facility <ref to="KSKCERM2" /> which had 
        received the encrypted USB stick. They placed their cards 
        together in the HSM to recreate the SMK; this then allowed the 
        USB stick to be imported into the HSM and decrypted. From that 
        point, the Recovery Key Shareholders are not required to take an 
        active part in any Key Ceremonies; their role is that of a 
        backup.  Some media outlets reported that these people have the 
        ability to "reboot the Internet" in the event of an emergency 
        <ref to="TIME-REBOOT" /><ref to="GUARD-REBOOT" />; while that's 
        somewhat of an over dramatisation, it is true that they are the 
        only people who are able to recover the Private KSK from the USB 
        sticks in the extremely rare situation that all the HSMs fail at 
        both facilities <ref to="ICANN-DPS" />.
      </p>
    </section>

    <section title="End of an Era">
      <p>
        The KSK Generation Ceremony will be repeated at the end of this 
        month <ref to="KSK-ROLLOVER" />.  A new Root KSK will be 
        generated as a replacement to the current one, which will be 
        phased out over the next couple of years.  This event is known 
        as the "KSK Rollover" and is an important part of maintaining 
        Internet security <ref to="RFC7583" />.  Although the Private 
        Key of the Root KSK is kept under such extreme security, it is 
        still good practice to replace it every few years, as one final 
        measure to ensure it can never fall into the wrong hands.
      </p>

      <p>
        If you'd like to review the Key Ceremony scripts or watch the 
        Live Stream of the event as it happens from 17:15 to midnight 
        (UK Time) on the 27th of October, head on over to:
        https://www.iana.org/dnssec/ceremonies/27
      </p>
    </section>
  </content>

	<foot>
    <section title="Note about the Root Zone">
      <p>
        Above I said that IANA/ICANN manages the Root Zone. This isn't 
        100% true. While ICANN does have authority over the content of 
        the Root Zone, the actual management of it is actually done by 
        Verisign. Verisign manages the Root Nameserver 'A' which is the 
        authority used by the other 12 Root Servers.
      </p>
    </section>

    <section title="ICANN Root Zone KSK">
      <p>
        DS RR: . IN 19036 8 2
        49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5
      </p>

      <p>Generated: 16 June 2010</p>

      <fig>
        -----BEGIN CERTIFICATE-----
        MIIDyjCCArKgAwIBAgIBBzANBgkqhkiG9w0BAQsFADBLMQ4wDAYDVQQKEwVJQ0FO
        TjEYMBYGA1UEAxMPSUNBTk4gRE5TU0VDIENBMR8wHQYJKoZIhvcNAQkBExBkbnNz
        ZWNAaWNhbm4ub3JnMB4XDTE0MDYxMTE4NDMyMFoXDTE3MDYxMDE4NDMyMFowgbMx
        DjAMBgNVBAoTBUlDQU5OMQ0wCwYDVQQLEwRJQU5BMTAwLgYDVQQDEydSb290IFpv
        bmUgS1NLIDIwMTAtMDYtMTZUMjE6MTk6MjQrMDA6MDAxYDBeBggrBgEEAYdoNRNS
        LiBJTiBEUyAxOTAzNiA4IDIgNDlBQUMxMUQ3QjZGNjQ0NjcwMkU1NEExNjA3Mzcx
        NjA3QTFBNDE4NTUyMDBGRDJDRTFDRERFMzJGMjRFOEZCNTCCASIwDQYJKoZIhvcN
        AQEBBQADggEPADCCAQoCggEBAKgAIKlVZrpC6Ia7gEzahOR+9W29euxhJhVVLOyQ
        bSEW0O8gcCjFFVQUTf6v58fLjwBd0YI0EzrAcQqBGCzh/RStIoO8g0NfnfL2MTJR
        kxoXbfDaUeVPQuYEhg37NZWAJQ9VnMVDxP/VHL496M/QZxkjf5/Efucp2gaDX6RS
        6CXpoY68LsvPVjR0ZSwzz1apAzvN9dlzEheX7ICJBBtuA6G3LQpzW5hOA2hzCTMj
        JPJ8LbqF6dsV6DoBQzgul0sGIcGOYl7OyQdXfZ57relSQageu+ipAdTTJ25AsRTA
        oub8ONGcLmqrAmRLKBP1dfwhYB4N7knNnulqQxA+Uk1ihz0CAwEAAaNQME4wDAYD
        VR0TAQH/BAIwADAfBgNVHSMEGDAWgBSPskJpw53kPPoTuf/ywKTv2A/oIjAdBgNV
        HQ4EFgQUQRqS+htWdh5iK3HNGv27Q5lfCckwDQYJKoZIhvcNAQELBQADggEBALsL
        hwY+hXsV6i6UI1ijqrBDP200JYHYIIJn4tTN9kpG+q7feQ52XhzydV3iPRgwV14L
        FqHc26ibnT3Afw+bHnvV7vrDOdvejfaw7cE7OGcJK3twQyvQ/XX2EWVr9qk7BE74
        CeqVP0ghSY87juF5MGV2Zdz/+IhMPrjFY2kQea615Qkl/TD1x3PxJNoq3YaXRDZu
        skVUjpepBhLLECq8Ewi2w03T8xxj4e6/1AAIBh8POpKVoBS1njSqlAz6zK2ZaWmS
        OQQBuGpn7e28dDvCeuagqV3qdwdfkbDuLb5DYUobGu2UsnjJ8Vp6E+evCU95p7lJ
        N0M89yQUKiyCrj9/lpg=
        -----END CERTIFICATE-----
      </fig>
    </section>
  </foot>

  <references>
    <reference id="EM-ICANN">
      <author>Shepherd, E.</author>
      <title>What has the US done with the Internet?</title>
      <date day="7" month="October" year="2016" />
      <url>https://emilyshepherd.me/memo/icann</url>
    </reference>

    <reference id="IANA-KSK">
      <author>Internet Assigned Numbers Authority</author>
      <title>Trust Anchors and Keys</title>
      <date month="August" year="2010" />
      <url>https://www.iana.org/dnssec/files</url>
    </reference>

    <reference id="RFC1034">
      <author>Mockapetris, P.</author>
      <title>DOMAIN NAMES - CONCEPTS AND FACILITIES</title>
      <date month="November" year="1987" />
      <url>https://www.ietf.org/rfc/rfc1034.txt</url>
    </reference>

    <reference id="RFC1035">
      <author>Mockapetris, P.</author>
      <title>DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION</title>
      <date month="November" year="1987" />
      <url>https://www.ietf.org/rfc/rfc1035.txt</url>
    </reference>

    <reference id="RFC3757">
      <author>Kolkman, O., Schlyter, J., and Lewis, E.</author>
      <title>
        Domain Name System KEY (DNSKEY) Resource Record (RR) Secure 
        Entry Point (SEP) Flag
      </title>
      <date month="April" year="2004" /> 
      <url>https://www.ietf.org/rfc/rfc3757.txt</url>
    </reference>

    <reference id="RFC5011">
      <author>StJohns, M.</author>
      <title>
        Automated Updates of DNS Security (DNSSEC) Trust Anchors
      </title>
      <date month="September" day="2007" /> 
      <url>https://www.ietf.org/rfc/rfc5011.txt</url>
    </reference>

    <reference id="RFC6781">
      <author>Kolkman, O., Mekking, W., and Gieben, R.</author>
      <title>DNSSEC Operational Practices, Version 2</title>
      <date month="December" year="2012" /> 
      <url>https://www.ietf.org/rfc/rfc6781.txt</url>
    </reference>

    <reference id="RFC7958">
      <author>
        Abley, J., Schlyter, J., Bailey, G., and Hoffman, P.
      </author>
      <title>
        DNSSEC Trust Anchor Publication for the Root Zone
      </title>
      <date month="August" year="2016" />
      <url>https://www.ietf.org/rfc/rfc3757.txt</url>
    </reference>

    <reference id="WHOIS-GOOGLE">
      <author>MarkMonitor</author>
      <title>Whois google.com</title>
      <date day="15" month="September" year="1997" />
      <url>http://www.whois.com/whois/google.com</url>
    </reference>

    <reference id="ICANN-DPS">
      <title>
        DNSSEC Practice Statement for the Root Zone KSK Operator
      </title>
      <author>
        Ljunggren, F., Okubo, T., Lamb, R., and Schlyter, J.
      </author>
      <date month="May" year="2010" />
      <url>
        http://www.root-dnssec.org/wp-content/uploads/2010/06/icann-dps-00.txt
      </url>
    </reference>

    <reference id="ICANN-CERM">
      <title>Root Zone DNSSEC KSK Ceremonies Guide</title>
      <author>Schlyter, J., Ljunggren, F., and Lamb, R.</author>
      <date month="May" year="2010" />
      <url>
        http://www.root-dnssec.org/wp-content/uploads/2010/05/draft-icann-dnssec-ceremonies-01.txt
      </url>
    </reference>

    <reference id="ICANN-CERM1">
      <title>
        ICANN's First DNSSEC Key Ceremony for the Root Zone
      </title>
      <author>ICANN</author>
      <date month="June" year="2010" day="7" />
      <url>
        https://www.icann.org/news/announcement-2-2010-06-07-en
      </url>
    </reference>

    <reference id="KSKCERM1">
      <title>Index of /ksk-ceremony/1</title>
      <author>Internet Assigned Numbers Authority</author>
      <date month="June" year="2010" day="16" />
      <url>https://data.iana.org/ksk-ceremony/1/</url>
    </reference>

    <reference id="KSKCERM2">
      <title>Index of /ksk-ceremony/2</title>
      <author>Internet Assigned Numbers Authority</author>
      <date month="July" year="2010" day="12" />
      <url>https://data.iana.org/ksk-ceremony/2/</url>
    </reference>

    <reference id="GUARD-REBOOT">
      <title>Is there really a key to reboot the internet?</title>
      <author>Kiss, J.</author>
      <date month="July" year="2010" day="27" />
      <url>
        https://www.theguardian.com/technology/2010/jul/27/internet-key
      </url>
    </reference>

    <reference id="KSK-ROLLOVER">
      <title>Root Zone KSK Rollover</title>
      <author>ICANN</author>
      <url>https://www.icann.org/resources/pages/ksk-rollover</url>
    </reference>

    <reference id="TIME-REBOOT">
      <title>
        This Man Has a Key That Can Shut Down the Entire Internet
      </title>
      <author>Stampler, L.</author>
      <date month="March" year="2014" day="17" />
      <url>
        http://time.com/27682/key-to-internet-pail-klane-british/
      </url>
    </reference>

    <reference id="RFC7583">
      <title>DNSSEC Key Rollover Timing Considerations</title>
      <author>
        Morris, S., Ihren, J., Dickinson, J., and Mekking, W.
      </author>
      <date month="October" year="2015" />
      <url>https://www.ietf.org/rfc/rfc7583.txt</url>
    </reference>
  </references>
</memo>

